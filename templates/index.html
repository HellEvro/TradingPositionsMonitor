<!DOCTYPE html>
<html lang="{{ get_current_language() }}">
<head>
    <title>Trading Positions Monitor</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    
    <!-- –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- –ó–∞—Ç–µ–º –ø–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à–∏ –º–æ–¥—É–ª–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ -->
    <script src="{{ url_for('static', filename='js/config.js') }}"></script>
    <script src="{{ url_for('static', filename='js/constants.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chart.js') }}"></script>
    <script src="{{ url_for('static', filename='js/positions.js') }}"></script>
    <script src="{{ url_for('static', filename='js/statistics.js') }}"></script>
    <script src="{{ url_for('static', filename='js/exchange_manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/position_closer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/single_position_closer.js') }}"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/get_language');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                if (data.success) {
                    document.documentElement.lang = data.language;
                    updateInterface();
                }
            } catch (error) {
                console.error('Error getting language:', error);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                document.documentElement.lang = 'en';
                updateInterface();
            }
        });
    </script>
</head>
<body>
    <div class="header-container">
        <h1 class="header-title">Trading Positions Monitor</h1>
        <div class="last-update header-update">
            <span data-translate="last-update">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>: <span id="update-time">-</span>
        </div>
    </div>

    <div class="controls-wrapper">
        <div class="menu-container">
            <!-- –ë—É—Ä–≥–µ—Ä –º–µ–Ω—é -->
            <div class="burger-menu">
                <button class="burger-button" onclick="toggleMenu()">
                    ‚ò∞ <span id="currentPage" class="menu-title" data-translate="positions">–ü–æ–∑–∏—Ü–∏–∏</span>
                </button>
                <div class="menu-dropdown" id="menuDropdown">
                    <a class="menu-item" onclick="window.app.showTab('positions')" id="positionsMenuItem" data-translate="positions">–ü–æ–∑–∏—Ü–∏–∏</a>
                    <a class="menu-item" onclick="window.app.showTab('trading')" id="tradingMenuItem" data-translate="trading">–¢–æ—Ä–≥–æ–≤–ª—è</a>
                    <a class="menu-item" onclick="window.app.showTab('closedPnl')" id="closedPnlMenuItem" data-translate="closedPnl">–ó–∞–∫—Ä—ã—Ç—ã–µ PNL</a>
                </div>
            </div>

            <!-- –ü–æ–∏—Å–∫ -->
            <div class="search-container">
                <input type="text" 
                       id="tickerSearch" 
                       placeholder="–ü–æ–∏—Å–∫ —Ç–∏–∫–µ—Ä–∞..."
                       class="search-input">
                <button id="clearSearch" class="clear-search">√ó</button>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="controls-panel">
            <div class="control-item">
                <select id="exchange-select" class="exchange-select">
                    <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </select>
            </div>
            <div class="control-item" onclick="window.app.toggleTheme()">
                <span data-translate="theme">üåì –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</span>
            </div>
            <label class="control-item reduce-load">
                <input type="checkbox" id="reduceLoadCheckbox">
                <span data-translate="reduceLoad">–°–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É</span>
            </label>
            <div class="control-item" onclick="toggleLanguage()">
                <span>üåê RU/EN</span>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="positions-container">
            <div id="rapid-growth-container" class="rapid-growth">
                <div class="rapid-growth-title">
                    <span data-translate="rapidGrowth">–ë—ã—Å—Ç—Ä–æ—Ä–∞—Å—Ç—É—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏</span>
                    <button id="clear-rapid-growth" class="clear-button" data-translate="clear">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                <div id="rapid-growth-positions"></div>
            </div>
            
            <div class="row-container" id="positions-row">
                <div class="section third-width">
                    <div id="high-profitable-positions-header">
                        <div class="header-content">
                            <div class="title-container">
                                <span class="header-prefix">PnL > </span>
                                <input type="number" id="pnl-filter-input" value="100" min="5" step="5" class="header-input">
                                <span class="header-suffix">USDT</span>
                                <span class="position-count">(0)</span>
                            </div>
                            <button class="close-positions-btn mass-close" data-column="high-profitable">‚úï</button>
                        </div>
                    </div>
                    <div class="sort-container">
                        <span class="sort-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
                        <select class="sort-select" id="sort-high-profitable-positions">
                            <option value="pnl_desc">PNL (–º–∞–∫—Å-–º–∏–Ω)</option>
                            <option value="pnl_asc">PNL (–º–∏–Ω-–º–∞–∫—Å)</option>
                            <option value="roi_desc">ROI (–º–∞–∫—Å-–º–∏–Ω)</option>
                            <option value="roi_asc">ROI (–º–∏–Ω-–º–∞–∫—Å)</option>
                            <option value="alphabet_asc">A-Z</option>
                            <option value="alphabet_desc">Z-A</option>
                        </select>
                    </div>
                    <div id="high-profitable-positions"></div>
                </div>
                
                <div class="section third-width">
                    <div id="profitable-positions-header">
                        <div class="header-content">
                            <div class="title-container">PnL < 100 USDT <span class="position-count">(0)</span></div>
                            <button class="close-positions-btn mass-close" data-column="profitable">‚úï</button>
                        </div>
                    </div>
                    <div class="sort-container">
                        <span class="sort-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
                        <select class="sort-select" id="sort-profitable-positions">
                            <option value="pnl_desc">PNL (–º–∞–∫—Å-–º–∏–Ω)</option>
                            <option value="pnl_asc">PNL (–º–∏–Ω-–º–∞–∫—Å)</option>
                            <option value="roi_desc">ROI (–º–∞–∫—Å-–º–∏–Ω)</option>
                            <option value="roi_asc">ROI (–º–∏–Ω-–º–∞–∫—Å)</option>
                            <option value="alphabet_asc">A-Z</option>
                            <option value="alphabet_desc">Z-A</option>
                        </select>
                    </div>
                    <div id="profitable-positions"></div>
                </div>
                
                <div class="section third-width">
                    <div id="losing-positions-header">
                        <div class="header-content">
                            <div class="title-container">Losing Positions <span class="position-count">(0)</span></div>
                            <button class="close-positions-btn mass-close" data-column="losing">‚úï</button>
                        </div>
                    </div>
                    <div class="sort-container">
                        <span class="sort-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
                        <select class="sort-select" id="sort-losing-positions">
                            <option value="pnl_desc">PNL (–º–∞–∫—Å-–º–∏–Ω)</option>
                            <option value="pnl_asc">PNL (–º–∏–Ω-–º–∞–∫—Å)</option>
                            <option value="roi_desc">ROI (–º–∞–∫—Å-–º–∏–Ω)</option>
                            <option value="roi_asc">ROI (–º–∏–Ω-–º–∞–∫—Å)</option>
                            <option value="alphabet_asc">A-Z</option>
                            <option value="alphabet_desc">Z-A</option>
                        </select>
                    </div>
                    <div id="losing-positions"></div>
                </div>
            </div>
        </div>
        
        <div class="stats-container">
            <div class="section">
                <h2 data-translate="statistics">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="chart-container">
                    <canvas id="pnlChart"></canvas>
                </div>
                <div>
                    <div data-translate="total-pnl-label">–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å + —É–±—ã—Ç–æ–∫:</div>
                    <div id="total-pnl" class="stats-value"></div>
                </div>
                <div style="margin: 15px 0;">
                    <div data-translate="total-profit-label">–ü—Ä–∏–±—ã–ª—å –ø–æ –ø–æ–∑–∏—Ü–∏—è–º:</div>
                    <div id="total-profit" class="stats-value positive"></div>
                </div>
                <div style="margin: 15px 0;">
                    <div data-translate="total-loss-label">–£–±—ã—Ç–æ–∫ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º:</div>
                    <div id="total-loss" class="stats-value negative"></div>
                </div>
                <hr>
                <div>
                    <div class="stats-flex-row">
                        <span data-translate="total-trades-label">–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫:</span>
                        <div id="total-trades" class="stats-value blue"></div>
                    </div>
                    <div class="stats-flex-row">
                        <span data-translate="profitable-trades-label">- –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫:</span>
                        <div id="total-all-profitable" class="stats-value positive"></div>
                    </div>
                    <div class="stats-flex-row">
                        <span data-translate="losing-trades-label">- —É–±—ã—Ç–æ—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫:</span>
                        <div id="total-losing" class="stats-value negative"></div>
                    </div>
                </div>
                <hr class="stats-divider">
                <div>
                    <h3 data-translate="topProfitable">TOP-3 –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö:</h3>
                    <div id="top-profitable">
                        <div class="top-row">
                            <div class="coin-name"></div>
                            <div class="pnl-value positive"></div>
                        </div>
                        <div class="top-row">
                            <div class="coin-name"></div>
                            <div class="pnl-value positive"></div>
                        </div>
                        <div class="top-row">
                            <div class="coin-name"></div>
                            <div class="pnl-value positive"></div>
                        </div>
                    </div>
                </div>
                <hr class="stats-divider">
                <div>
                    <h3 data-translate="topLosing">TOP-3 –£–±—ã—Ç–æ—á–Ω—ã—Ö:</h3>
                    <div id="top-losing">
                        <div class="top-row">
                            <div class="coin-name"></div>
                            <div class="pnl-value negative"></div>
                        </div>
                        <div class="top-row">
                            <div class="coin-name"></div>
                            <div class="pnl-value negative"></div>
                        </div>
                        <div class="top-row">
                            <div class="coin-name"></div>
                            <div class="pnl-value negative"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="closedPnlContainer" class="tab-content hidden">
        <div class="section">
            <div class="closed-pnl-header">
                <div class="page-size-container">
                    <h2 data-translate="closedPositions">–ó–∞–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏</h2>
                    <div>
                        <label for="pageSize" data-translate="showPerPage">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ</label>:
                        <select id="pageSize" onchange="window.app.changePageSize(this.value)" class="sort-select">
                            <option value="10">10</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                </div>
                <select id="sortSelect" onchange="window.app.updateClosedPnl()" class="sort-select">
                    <option value="time" data-translate="sortNew">–û—Ç –Ω–æ–≤–æ–≥–æ –∫ —Å—Ç–∞—Ä–æ–º—É</option>
                    <option value="pnl" data-translate="sortPnl">–ü–æ —Ä–∞–∑–º–µ—Ä—É PNL</option>
                </select>
            </div>
            <table class="pnl-table">
                <thead>
                    <tr>
                        <th data-translate="contracts">–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã</th>
                        <th data-translate="quantity">–ö–æ–ª-–≤–æ</th>
                        <th data-translate="entryPrice">–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</th>
                        <th data-translate="exitPrice">–¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞</th>
                        <th data-translate="realizedPnl">–†–µ–∞–ª—å–∑. P&L</th>
                        <th data-translate="tradingTime">–í—Ä–µ–º—è —Ç–æ—Ä–≥–æ–≤–ª–∏</th>
                    </tr>
                </thead>
                <tbody id="closedPnlTable">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </tbody>
            </table>
            <div class="pagination">
                <button class="pagination-btn" onclick="window.app.prevPage()" data-translate="prevPage">< –ù–∞–∑–∞–¥</button>
                <span id="pageInfo"></span>
                <button class="pagination-btn" onclick="window.app.nextPage()" data-translate="nextPage">–í–ø–µ—Ä–µ–¥ ></button>
            </div>
        </div>
    </div>

    <div id="tradingContainer" class="tab-content hidden">
        <div class="section">
            <div class="trading-content">
                <div class="trading-header">
                </div>
                <div class="available-pairs">
                    <h3 data-translate="availablePairs">–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞—Ä—ã</h3>
                    <div id="availablePairsList" class="pairs-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // –í—Å–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ –º–æ–¥—É–ª—å–Ω–æ–º –∫–æ–¥–µ
        });
    </script>
    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded');
            console.log('toggleLanguage function exists:', typeof window.toggleLanguage === 'function');
            console.log('Current language:', document.documentElement.lang);
        });
    </script>
</body>
</html> 